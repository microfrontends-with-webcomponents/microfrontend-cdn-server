(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{AHQ6:function(t,e,n){"use strict";n.r(e),n.d(e,"DanfesModule",function(){return J});var r=n("TEn/"),s=n("ofXK"),o=n("tyNb"),i=n("fXoL");let c=(()=>{class t{constructor(t){this.platformId=t}isPlatformBrowser(){return Object(s.m)(this.platformId)}}return t.\u0275fac=function(e){return new(e||t)(i.Xb(i.D))},t.\u0275prov=i.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var a=n("Ghd0");const l={patternOnlyNumber:/[^0-9]*/g,patternOnlyNumberAndBreak:/[^0-9\n]*/g};function u(t){var e;const n=null===(e=t.value)||void 0===e?void 0:e.trim().replace(l.patternOnlyNumberAndBreak,"");if(!n)return{listOfKeys:!0,listOfKeysError:"Informe pelo menos 1 chave v\xe1lida para pesquisar."};let r=n.split("\n").filter(t=>t.length&&l.patternOnlyNumber.test(t));if(!r.length)return{listOfKeys:!0,listOfKeysError:"Informe pelo menos 1 chave v\xe1lida para pesquisar."};let s=r.filter(t=>44!=t.length).map(t=>`${t} is invalid <br />`);return console.log("invalid keys: "+s),s.length?{listOfKeys:!0,listOfKeysError:s.join("")}:null}var b=n("3Pt+");let d=(()=>{class t{toOnlyNumberList(t){const e=null==t?void 0:t.trim().replace(l.patternOnlyNumberAndBreak,"");if(!e)return[];let n=e.split("\n").filter(t=>t.length&&l.patternOnlyNumber.test(t));return[...new Set(n)]}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=i.Kb({token:t,factory:t.\u0275fac}),t})();class h{static fromNow(t,e,n){let r=new h;return r.dtStart=t,r.dtStartNumber=e,r.totalInvoicesSearch=n,r.totalInvoicesFound=0,r}}let p=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=i.Kb({token:t,factory:t.\u0275fac}),t})(),f=(()=>{class t extends p{constructor(){super(...arguments),this.collectionName="/search_danfe"}}return t.\u0275fac=function(e){return m(e||t)},t.\u0275prov=i.Kb({token:t,factory:t.\u0275fac}),t})();const m=i.Vb(f);var g=n("I/3d");let v=(()=>{class t{constructor(t){this.db=t}insert(t,e){return this.db.collection(`${t}`).add(Object.assign({},e))}insertBatch(t,e){var n=this.db.firestore,r=n.batch();return e.forEach(e=>{var s=n.collection(t).doc();r.set(s,Object.assign({},e))}),r.commit()}delete(t,e){return this.db.collection(`${t}`).doc(e).delete()}}return t.\u0275fac=function(e){return new(e||t)(i.Xb(g.a))},t.\u0275prov=i.Kb({token:t,factory:t.\u0275fac}),t})();var y=function(t){return t[t.NOT_SEARCHED=0]="NOT_SEARCHED",t[t.FOUND=1]="FOUND",t[t.NOT_FOUND=2]="NOT_FOUND",t}({});class S{constructor(t,e,n){this.invoiceKey=t,this.idSearch=e,this.searchStatus=n}}class O extends class{constructor(){this.reset()}getAll(){return this.listOfItems}add(t){this.listOfItems.push(t)}reset(){this.listOfItems=[]}}{constructor(){super()}static fromStringList(t,e){let n=new O;return t.forEach(t=>{n.add(new S(t,e,y.NOT_SEARCHED))}),n}}let T=(()=>{class t extends p{constructor(){super(...arguments),this.collectionName="/search_danfe_item"}}return t.\u0275fac=function(e){return w(e||t)},t.\u0275prov=i.Kb({token:t,factory:t.\u0275fac}),t})();const w=i.Vb(T);let k=(()=>{class t{toSmallerLists(t,e){if(0==t.length)return t;let n=[];if(t.length<=e)return n.push(t),n;const r=Math.ceil(t.length/e);for(let s=0;s<r;s++){let r=t.splice(0,e);n.push(r)}return n}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=i.Kb({token:t,factory:t.\u0275fac}),t})(),x=(()=>{class t extends T{constructor(t,e){super(),this.repoCreator=t,this.utilList=e}insert(t,e){const n=O.fromStringList(t,e).getAll();this.insertBatch(n)}insertBatch(t){const e=this.utilList.toSmallerLists(t,250);console.log("sublistas"),console.log(e);const n=e.length,r=[];for(let s=0;s<n;s++){const t=e[s];console.log(t),r.push(this.repoCreator.insertBatch(this.collectionName,t))}Promise.all(r)}}return t.\u0275fac=function(e){return new(e||t)(i.Xb(v),i.Xb(k))},t.\u0275prov=i.Kb({token:t,factory:t.\u0275fac}),t})(),L=(()=>{class t{constructor(){}getCurrentDatetime(){return new Date}getDateNumber(t){let e=`${t.getFullYear()}${t.getMonth().toString().padStart(2,"0")}${t.getDate().toString().padStart(2,"0")}`;return Number(e)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=i.Kb({token:t,factory:t.\u0275fac}),t})(),C=(()=>{class t extends f{constructor(t,e,n){super(),this.repoCreator=t,this.creatorDanfeItem=e,this.utilDate=n}insertWithItems(t){return this.insert(t).then(e=>(this.creatorDanfeItem.insert(t,e.$key),e)).catch(t=>(console.log("ERROR:"+t),null))}insert(t){const e=this.utilDate.getCurrentDatetime(),n=h.fromNow(e,this.utilDate.getDateNumber(e),t.length);return this.repoCreator.insert(this.collectionName,n).then(t=>(n.$key=t.id,n)).catch(t=>(console.log("ERROR:"+t),null)).finally(()=>{console.log("FINAL:")})}}return t.\u0275fac=function(e){return new(e||t)(i.Xb(v),i.Xb(x),i.Xb(L))},t.\u0275prov=i.Kb({token:t,factory:t.\u0275fac}),t})();var N=n("5eHb");let I=(()=>{class t{constructor(t){this.toastr=t,this.isLoading=!1}success(t,e="Sucesso!",n=3e3){this.toastr.success(t,e,{timeOut:n,enableHtml:!0,closeButton:!0,positionClass:"toast-top-right",progressAnimation:"decreasing",progressBar:!0})}error(t,e="Falha!",n=3e3){this.toastr.error(t,e,{timeOut:n,enableHtml:!0,closeButton:!0,positionClass:"toast-top-right"})}}return t.\u0275fac=function(e){return new(e||t)(i.Xb(N.b))},t.\u0275prov=i.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var B=n("mrSG"),K=n("1Bn7");let M=(()=>{class t{constructor(t,e,n,r){this.loadingController=t,this.alertController=e,this.toastController=n,this.menuCtrl=r,this.isLoading=!1}presentLoading(){return Object(B.b)(this,void 0,void 0,function*(){return this.isLoading=!0,yield this.loadingController.create({spinner:"crescent",duration:1e4,translucent:!0,cssClass:"loadingDialog"}).then(t=>{t.present().then(()=>{console.log("presented"),this.isLoading||t.dismiss().then(()=>console.log("abort presenting"))})})})}presentTimeoutLoading(t,e){return Object(B.b)(this,void 0,void 0,function*(){return this.isLoading=!0,yield this.loadingController.create({spinner:"crescent",duration:t,translucent:e,cssClass:"loadingDialog"}).then(t=>{t.present().then(()=>{console.log("presented"),this.isLoading||t.dismiss().then(()=>console.log("abort presenting"))})})})}dismissLoading(){return Object(B.b)(this,void 0,void 0,function*(){return this.isLoading=!1,yield this.loadingController.dismiss().then(()=>console.log("dismissed"))})}presentAlert(t){return Object(B.b)(this,void 0,void 0,function*(){const e=yield this.alertController.create({header:"Alert",subHeader:"",message:t,buttons:["OK"]});yield e.present()})}presentToast(t,e=3e3){return Object(B.b)(this,void 0,void 0,function*(){(yield this.toastController.create({message:t,duration:e,color:"dark"})).present()})}presentToastSuccess(t,e=3e3){return Object(B.b)(this,void 0,void 0,function*(){(yield this.toastController.create({message:new K.a(`<ion-icon name="checkmark-done-outline" style="font-size:2em;vertical-align:middle;"></ion-icon> ${t}`),duration:e,color:"success",position:"top",keyboardClose:!0})).present()})}presentToastWithOptions(t,e,n,r,s,o){return Object(B.b)(this,void 0,void 0,function*(){(yield this.toastController.create({header:t,message:r,duration:o,color:"dark",position:s,buttons:[{side:"start",icon:e,text:n,handler:()=>{console.log("Favorite clicked")}},{text:"Done",role:"cancel",handler:()=>{console.log("Cancel clicked")}}]})).present()})}sideMenu(){console.log("toggle sidemenu"),this.menuCtrl.toggle()}}return t.\u0275fac=function(e){return new(e||t)(i.Xb(r.D),i.Xb(r.a),i.Xb(r.H),i.Xb(r.E))},t.\u0275prov=i.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const D=["*"];let E=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Ib({type:t,selectors:[["sinc-card"]],inputs:{title:"title",subTitle:"subTitle"},ngContentSelectors:D,decls:9,vars:2,template:function(t,e){1&t&&(i.fc(),i.Tb(0,"ion-card"),i.Tb(1,"ion-card-header"),i.Tb(2,"ion-card-header"),i.Tb(3,"ion-card-title"),i.qc(4),i.Sb(),i.Tb(5,"ion-card-subtitle"),i.qc(6),i.Sb(),i.Sb(),i.Sb(),i.Tb(7,"ion-card-content"),i.ec(8),i.Sb(),i.Sb()),2&t&&(i.Db(4),i.rc(e.title),i.Db(2),i.rc(e.subTitle))},directives:[r.g,r.i,r.k,r.j,r.h],styles:[""]}),t})(),F=(()=>{class t{constructor(t,e){this.el=t,this.render=e,this.allowBreakLine=!1,this.patternOnlyNumber=l.patternOnlyNumber,this.patternOnlyNumberAndBreak=l.patternOnlyNumberAndBreak}onInputChange(t){this.inputElement=this.el.nativeElement.getElementsByTagName("input")[0],this.inputElement||(this.inputElement=this.el.nativeElement.getElementsByTagName("textarea")[0]);const e=this.el.nativeElement.value;let n=e.replace(this.allowBreakLine?this.patternOnlyNumberAndBreak:this.patternOnlyNumber,"").replace("\n\n","");this.inputElement.value=n,e!==this.inputElement.value&&t.stopPropagation()}}return t.\u0275fac=function(e){return new(e||t)(i.Ob(i.m),i.Ob(i.F))},t.\u0275dir=i.Jb({type:t,selectors:[["","numbersOnly",""]],hostBindings:function(t,e){1&t&&i.bc("input",function(t){return e.onInputChange(t)})},inputs:{allowBreakLine:"allowBreakLine"}}),t})(),P=(()=>{class t{constructor(){this.errorMessage=""}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Ib({type:t,selectors:[["sinc-form-error"]],inputs:{errorMessage:"errorMessage"},decls:4,vars:1,consts:[["color","danger",1,"d-block"],[1,"text-smaller"],["name","warning-outline","size","small"],[3,"innerHTML"]],template:function(t,e){1&t&&(i.Tb(0,"ion-text",0),i.Tb(1,"span",1),i.Pb(2,"ion-icon",2),i.Pb(3,"span",3),i.Sb(),i.Sb()),2&t&&(i.Db(3),i.gc("innerHTML",e.errorMessage,i.kc))},directives:[r.x,r.p],styles:["ion-icon[_ngcontent-%COMP%]{padding-right:3px;padding-top:3px;vertical-align:top}"]}),t})(),j=(()=>{class t{constructor(){this.textMessage=""}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Ib({type:t,selectors:[["sinc-form-ok"]],inputs:{textMessage:"textMessage"},decls:4,vars:1,consts:[["color","success",1,"d-block"],[1,"text-smaller"],["name","checkmark-circle-outline","size","small"],[3,"innerHTML"]],template:function(t,e){1&t&&(i.Tb(0,"ion-text",0),i.Tb(1,"span",1),i.Pb(2,"ion-icon",2),i.Pb(3,"span",3),i.Sb(),i.Sb()),2&t&&(i.Db(3),i.gc("innerHTML",e.textMessage,i.kc))},directives:[r.x,r.p],styles:["ion-icon[_ngcontent-%COMP%]{padding-right:3px;padding-top:3px;vertical-align:top}"]}),t})();function q(t,e){if(1&t&&i.Pb(0,"sinc-form-error",9),2&t){const t=i.dc();i.gc("errorMessage",null==t.infoForm.get("invoiceKeys").errors?null:t.infoForm.get("invoiceKeys").errors.listOfKeysError)}}function A(t,e){if(1&t&&i.Pb(0,"sinc-form-ok",10),2&t){const t=i.dc();i.gc("textMessage",t.msgValidInvoiceKeys)}}let H=(()=>{class t{constructor(t,e,n,r,s){this.formBuilder=t,this.utilString=e,this.searchCreator=n,this.toastr=r,this.componentService=s}buildForm(){this.infoForm=this.formBuilder.group({invoiceKeys:["",[u]]}),this.infoForm.get("invoiceKeys").valueChanges.subscribe(t=>{this.listOfValidKeysMsg=this.utilString.toOnlyNumberList(t);const e=this.listOfValidKeysMsg.length;this.msgValidInvoiceKeys=e?`${e} danfes v\xe1lidas`:null})}submitForm(){this.componentService.presentLoading().then(()=>{if(!this.infoForm.valid)return this.componentService.dismissLoading(),void this.componentService.presentAlert("Erro ao validar o formul\xe1rio.");this.searchCreator.insertWithItems(this.listOfValidKeysMsg).then(t=>{this.infoForm.reset(),this.toastr.success("Seu pedido de pesquisa foi registrado com sucesso!<br /> Acompanhe o andamento no hist\xf3rico de consultas","",5e3)}),this.componentService.dismissLoading()})}ngOnInit(){this.buildForm()}}return t.\u0275fac=function(e){return new(e||t)(i.Ob(b.a),i.Ob(d),i.Ob(C),i.Ob(I),i.Ob(M))},t.\u0275cmp=i.Ib({type:t,selectors:[["sinc-search-danfes-form"]],decls:20,vars:5,consts:[[3,"formGroup","ngSubmit"],["title","","subTitle",""],["size","12"],["formControlName","invoiceKeys","rows","6","placeholder","Informe as chaves das notas fiscais aqui","numbersOnly","",3,"allowBreakLine"],[3,"errorMessage",4,"ngIf"],[3,"textMessage",4,"ngIf"],[1,"ion-text-right","text-sm","ion-margin-top"],["color","danger"],["color","primary","expand","block","type","submit",1,"ion-margin-top",3,"disabled"],[3,"errorMessage"],[3,"textMessage"]],template:function(t,e){1&t&&(i.Tb(0,"form",0),i.bc("ngSubmit",function(){return e.submitForm()}),i.Tb(1,"sinc-card",1),i.Tb(2,"ion-row"),i.Tb(3,"ion-col",2),i.Pb(4,"ion-textarea",3),i.pc(5,q,1,1,"sinc-form-error",4),i.pc(6,A,1,1,"sinc-form-ok",5),i.Sb(),i.Sb(),i.Tb(7,"ion-row"),i.Tb(8,"ion-col",2),i.Tb(9,"span"),i.Tb(10,"div",6),i.Tb(11,"ion-text",7),i.qc(12,"Aten\xe7\xe3o para n\xe3o utilizar chaves em nota\xe7\xe3o cient\xedfica!"),i.Sb(),i.Pb(13,"br"),i.Tb(14,"ion-text",7),i.qc(15,"Informe apenas uma chave por linha!"),i.Sb(),i.Sb(),i.Sb(),i.Sb(),i.Sb(),i.Tb(16,"ion-row"),i.Tb(17,"ion-col",2),i.Tb(18,"ion-button",8),i.qc(19,"Buscar"),i.Sb(),i.Sb(),i.Sb(),i.Sb(),i.Sb()),2&t&&(i.gc("formGroup",e.infoForm),i.Db(4),i.gc("allowBreakLine",!0),i.Db(1),i.gc("ngIf",(null==e.infoForm.get("invoiceKeys").errors?null:e.infoForm.get("invoiceKeys").errors.listOfKeys)&&e.infoForm.get("invoiceKeys").touched),i.Db(1),i.gc("ngIf",e.msgValidInvoiceKeys),i.Db(12),i.gc("disabled",e.infoForm.invalid))},directives:[b.j,b.h,b.c,E,r.w,r.l,r.y,r.G,b.g,b.b,F,s.i,r.x,r.e,P,j],styles:[""]}),t})();const X=[{path:"",redirectTo:"search"},{path:"search",component:(()=>{class t{constructor(t){this.platService=t}ngOnInit(){console.log(`Is a browser: ${this.platService.isPlatformBrowser()}`)}}return t.\u0275fac=function(e){return new(e||t)(i.Ob(c))},t.\u0275cmp=i.Ib({type:t,selectors:[["app-danfes-search"]],decls:33,vars:1,consts:[["title","DANFES 3P",3,"hasBackButton"],[1,"ion-padding"],["size-md","6","size-sm","12","size","12"],["lines",""],[1,"ion-float-end"],["color","primary","value","0.5"],["href",""],["color","success","value","1"]],template:function(t,e){1&t&&(i.Pb(0,"sinc-header-default",0),i.Tb(1,"ion-content",1),i.Tb(2,"ion-row"),i.Tb(3,"ion-col",2),i.Pb(4,"sinc-search-danfes-form"),i.Sb(),i.Tb(5,"ion-col",2),i.Tb(6,"ion-list"),i.Tb(7,"ion-list-header",3),i.Tb(8,"h2"),i.qc(9,"Hist\xf3rico de consultas"),i.Sb(),i.Sb(),i.Tb(10,"ion-item"),i.Tb(11,"ion-label"),i.Tb(12,"ion-text"),i.qc(13,"24/04/2010 09:00:00"),i.Sb(),i.Tb(14,"ion-text",4),i.qc(15,"10/1200"),i.Sb(),i.Pb(16,"ion-progress-bar",5),i.Sb(),i.Sb(),i.Tb(17,"ion-item"),i.Tb(18,"ion-label"),i.Tb(19,"ion-text"),i.qc(20,"24/04/2010 09:00:00"),i.Sb(),i.Tb(21,"ion-text",4),i.qc(22,"10/1200"),i.Sb(),i.Pb(23,"ion-progress-bar",5),i.Sb(),i.Sb(),i.Tb(24,"ion-item"),i.Tb(25,"ion-label"),i.Tb(26,"ion-text"),i.qc(27,"24/04/2010 09:00:00"),i.Sb(),i.Tb(28,"ion-text",4),i.qc(29,"10/1200 "),i.Tb(30,"a",6),i.qc(31,"Clique aqui para baixar"),i.Sb(),i.Sb(),i.Pb(32,"ion-progress-bar",7),i.Sb(),i.Sb(),i.Sb(),i.Sb(),i.Sb(),i.Sb()),2&t&&i.gc("hasBackButton",!0)},directives:[a.a,r.m,r.w,r.l,H,r.s,r.t,r.q,r.r,r.x,r.u],styles:["ion-progress-bar[_ngcontent-%COMP%]{height:30px}"]}),t})()}];let $=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.Mb({type:t}),t.\u0275inj=i.Lb({imports:[[o.j.forChild(X)]]}),t})(),_=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.Mb({type:t}),t.\u0275inj=i.Lb({imports:[[r.B,s.c]]}),t})(),R=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.Mb({type:t}),t.\u0275inj=i.Lb({imports:[[r.B,s.c]]}),t})(),z=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.Mb({type:t}),t.\u0275inj=i.Lb({}),t})(),V=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.Mb({type:t}),t.\u0275inj=i.Lb({providers:[d,L,k,I,C,x,v],imports:[[r.B,s.c,b.d,b.i,_,R,z]]}),t})();var G=n("eG9i");let U=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.Mb({type:t}),t.\u0275inj=i.Lb({imports:[[r.B,V,G.a]]}),t})(),J=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.Mb({type:t}),t.\u0275inj=i.Lb({imports:[[r.B,s.c,U,V,$]]}),t})()}}]);